# План развития системы ЛЭП Management

## 🎯 Текущее состояние

### Реализовано:
- ✅ Карта с отображением ЛЭП, опор, подстанций
- ✅ Базовое управление объектами (создание, редактирование)
- ✅ Дерево объектов в сайдбаре
- ✅ Аутентификация и авторизация
- ✅ API для основных сущностей

### Проблемы и ограничения:
- ❌ Подстанции отображаются только как точки на карте
- ❌ Нет детального просмотра оборудования подстанции
- ❌ Нет связи между подстанциями и оборудованием
- ❌ Нет типизации подстанций (ТП, КТП, МТП)
- ❌ На карте слишком много информации при большом количестве оборудования

## 🚀 Предлагаемое решение

### Концепция: Двухрежимный интерфейс

#### Режим 1: Карта (текущий)
- Отображение геопозиций объектов
- Визуализация связей между объектами
- Навигация по территории
- Минимальная информация на карте

#### Режим 2: Детальный просмотр (новый)
- Детальная информация об объектах
- Полный список оборудования
- Характеристики и параметры
- Иерархическая структура

## 📋 План реализации

### Этап 1: Расширение модели данных

#### 1.1. Типы подстанций
```python
# Добавить в модель Substation
substation_type = Column(String(20), nullable=False)  # ТП, КТП, МТП, РП
```

#### 1.2. Связь Equipment с Substation
```python
# В модели Equipment добавить
substation_id = Column(Integer, ForeignKey("substations.id"), nullable=True)
substation = relationship("Substation", back_populates="equipment")
```

#### 1.3. Расширение модели Equipment
```python
# Добавить поля для детального описания
equipment_category = Column(String(50))  # Трансформатор, Выключатель, Разъединитель
manufacturer = Column(String(100))
model = Column(String(100))
serial_number = Column(String(100))
installation_date = Column(DateTime)
last_maintenance_date = Column(DateTime)
next_maintenance_date = Column(DateTime)
status = Column(String(20))  # active, maintenance, decommissioned
```

### Этап 2: Backend API

#### 2.1. Новые endpoints для подстанций
```
GET /api/v1/substations/{id}/equipment - Получить оборудование подстанции
GET /api/v1/substations/{id}/details - Детальная информация о подстанции
POST /api/v1/substations/{id}/equipment - Добавить оборудование
PUT /api/v1/substations/{id}/equipment/{equipment_id} - Обновить оборудование
DELETE /api/v1/substations/{id}/equipment/{equipment_id} - Удалить оборудование
```

#### 2.2. Фильтрация и поиск
```
GET /api/v1/substations?type=ТП - Фильтр по типу
GET /api/v1/substations?region_id=1 - Фильтр по региону
GET /api/v1/substations?search=название - Поиск
```

### Этап 3: Frontend - Новая вкладка/страница

#### 3.1. Структура компонентов
```
substations/
├── substations-list/          # Список подстанций
│   ├── substations-list.component.ts
│   ├── substations-list.component.html
│   └── substations-list.component.scss
├── substation-detail/          # Детальный просмотр (НОВЫЙ)
│   ├── substation-detail.component.ts
│   ├── substation-detail.component.html
│   └── substation-detail.component.scss
└── substation-equipment/       # Компонент оборудования (НОВЫЙ)
    ├── substation-equipment.component.ts
    ├── substation-equipment.component.html
    └── substation-equipment.component.scss
```

#### 3.2. Навигация
- Добавить вкладку "Подстанции" в главное меню
- При клике на подстанцию на карте → переход в детальный просмотр
- При клике на подстанцию в списке → детальный просмотр

#### 3.3. UI/UX дизайн

**Страница списка подстанций:**
```
┌─────────────────────────────────────────┐
│  Подстанции                    [+ Создать]│
├─────────────────────────────────────────┤
│  [Фильтры: Тип ▼] [Поиск...]           │
├─────────────────────────────────────────┤
│  ┌───────────────────────────────────┐ │
│  │ ТП-123 "Центральная"              │ │
│  │ 10 кВ | Минск, ул. Ленина, 1     │ │
│  │ Оборудование: 15 ед.             │ │
│  └───────────────────────────────────┘ │
│  ┌───────────────────────────────────┐ │
│  │ КТП-456 "Промышленная"            │ │
│  │ 35 кВ | Минск, пр. Победителей, 5│ │
│  │ Оборудование: 8 ед.               │ │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

**Страница детального просмотра:**
```
┌─────────────────────────────────────────┐
│  ← Назад    ТП-123 "Центральная"        │
├─────────────────────────────────────────┤
│  [Основная информация] [Оборудование]   │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ Тип: ТП                            │ │
│  │ Напряжение: 10 кВ                  │ │
│  │ Адрес: Минск, ул. Ленина, 1       │ │
│  │ Статус: Активна                    │ │
│  │ Подключенные ЛЭП: 3                │ │
│  └───────────────────────────────────┘ │
│                                         │
│  Оборудование (15 ед.):                │
│  ┌───────────────────────────────────┐ │
│  │ Трансформатор ТМ-1000              │ │
│  │ Производитель: ABB                 │ │
│  │ Статус: Активен                    │ │
│  │ Последнее ТО: 01.01.2024          │ │
│  └───────────────────────────────────┘ │
│  ┌───────────────────────────────────┐ │
│  │ Выключатель ВМГ-10                │ │
│  │ Производитель: Siemens            │ │
│  │ Статус: На обслуживании            │ │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Этап 4: Интеграция с картой

#### 4.1. Клик на подстанцию на карте
- Показывать popup с краткой информацией
- Кнопка "Подробнее" → переход в детальный просмотр
- Кнопка "Показать на карте" → центрирование

#### 4.2. Синхронизация состояний
- При выборе подстанции на карте → выделение в списке
- При выборе в списке → центрирование на карте

## 🎨 UI/UX Рекомендации

### Принципы дизайна:
1. **Разделение контекстов**: Карта для географии, детальный просмотр для данных
2. **Иерархия информации**: От общего к частному
3. **Быстрый доступ**: Важная информация всегда видна
4. **Фильтрация**: Возможность быстро найти нужное

### Компоненты Material Design:
- `MatTabs` - для переключения между вкладками (Основная информация / Оборудование)
- `MatTable` - для таблицы оборудования
- `MatExpansionPanel` - для группировки оборудования по категориям
- `MatChips` - для статусов и тегов
- `MatDialog` - для создания/редактирования оборудования

## 📊 Структура данных

### Иерархия:
```
Подстанция (Substation)
├── Основная информация
│   ├── Название, код
│   ├── Тип (ТП, КТП, МТП)
│   ├── Напряжение
│   ├── Адрес, координаты
│   └── Статус
├── Подключения (Connections)
│   └── Связанные ЛЭП
└── Оборудование (Equipment)
    ├── Трансформаторы
    ├── Выключатели
    ├── Разъединители
    ├── Защита
    └── Прочее
```

## 🔄 Миграция данных

### Шаги:
1. Создать миграцию для добавления полей в Substation
2. Создать миграцию для связи Equipment с Substation
3. Добавить типы подстанций в справочник
4. Мигрировать существующие данные

## 📝 Примеры использования

### Сценарий 1: Просмотр оборудования подстанции
1. Пользователь открывает карту
2. Кликает на подстанцию
3. Видит popup с краткой информацией
4. Нажимает "Подробнее"
5. Открывается страница детального просмотра
6. Переключается на вкладку "Оборудование"
7. Видит список всего оборудования с характеристиками

### Сценарий 2: Добавление оборудования
1. Пользователь в детальном просмотре подстанции
2. Нажимает "Добавить оборудование"
3. Заполняет форму (тип, производитель, модель, etc.)
4. Сохраняет
5. Оборудование появляется в списке

### Сценарий 3: Фильтрация подстанций
1. Пользователь открывает список подстанций
2. Выбирает фильтр "Тип: ТП"
3. Видит только трансформаторные подстанции
4. Ищет по названию "Центральная"
5. Находит нужную подстанцию

## 🎯 Приоритеты реализации

### Высокий приоритет:
1. ✅ Расширение модели данных (Substation type, Equipment link)
2. ✅ API endpoints для оборудования подстанции
3. ✅ Страница детального просмотра подстанции
4. ✅ Компонент списка оборудования

### Средний приоритет:
1. Фильтрация и поиск подстанций
2. Интеграция с картой (popup, переход)
3. Создание/редактирование оборудования

### Низкий приоритет:
1. Экспорт данных подстанции
2. История изменений оборудования
3. Планирование обслуживания
4. Уведомления о необходимости ТО

## 🔮 Будущие улучшения

### Фаза 2:
- Схематическое изображение подстанции
- Однолинейная схема
- 3D визуализация оборудования
- Интеграция с SCADA системами

### Фаза 3:
- Планирование ремонтов
- Учет материалов и запчастей
- Отчетность и аналитика
- Мобильное приложение для полевых работ

## 📚 Дополнительные материалы

- [Стандарты типов подстанций](https://example.com)
- [Классификация оборудования](https://example.com)
- [Руководство по эксплуатации](https://example.com)
