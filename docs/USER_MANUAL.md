# Инструкция для пользователя системы управления ЛЭП

## Начало работы

При запуске приложения пользователь попадает на экран входа в систему. Для доступа к функционалу необходимо ввести логин и пароль в соответствующие поля формы и нажать кнопку "Войти". Система автоматически проверяет учетные данные и при успешной аутентификации перенаправляет пользователя на главный экран приложения.

*См. экран входа: `web-frontend/src/app/features/auth/login/login.component.html:1-41`*

## Главный экран приложения

После успешного входа пользователь видит главный экран, состоящий из нескольких основных элементов интерфейса. В верхней части экрана расположена панель инструментов с названием системы "ЛЭП Management System" и меню пользователя, доступное через иконку профиля в правом верхнем углу. Из меню пользователя можно выйти из системы. Центральную часть экрана занимает интерактивная карта, на которой отображаются все объекты энергетической инфраструктуры. Слева от карты расположена боковая панель с деревом объектов, которую можно скрыть или показать с помощью кнопки со стрелкой, а также изменить её ширину, перетаскивая границу панели.

*См. главный экран: `web-frontend/src/app/layout/main-layout/main-layout.component.html:1-35`*

## Работа с картой

Карта является основным инструментом визуализации объектов энергетической сети. На карте отображаются линии электропередач в виде красных линий, опоры в виде синих точек, отпайки в виде оранжевых маркеров и подстанции в виде фиолетовых маркеров. При клике на маркер опоры открывается всплывающее окно с информацией о свойствах опоры, включая номер опоры, уникальный идентификатор (UID), название участка линии и координаты. В правом верхнем углу карты расположены кнопки управления: кнопка создания нового объекта и кнопка обновления данных карты. В левом нижнем углу карты находится индикатор уровня масштабирования с кнопками увеличения и уменьшения зума, отображающий текущий уровень зума и примерное расстояние, соответствующее текущему масштабу карты.

*См. компонент карты: `web-frontend/src/app/features/map/map.component.html:1-59`, `web-frontend/src/app/features/map/map.component.ts:115-154` (инициализация карты)*

При масштабировании карты система автоматически управляет отображением подписей опор: при уровне зума от 15 до 20 подписи с номерами опор отображаются на карте, при других уровнях зума подписи скрываются для улучшения читаемости карты. Индикатор зума автоматически перемещается вправо при открытии боковой панели, чтобы не перекрываться с деревом объектов.

*См. динамические подписи: `web-frontend/src/app/features/map/map.component.ts:363-390`, управление зумом: `web-frontend/src/app/features/map/map.component.ts:525-535`*

## Дерево объектов

Боковая панель содержит иерархическое дерево объектов, организованное по принципу вложенности. На верхнем уровне находятся линии электропередач, которые можно раскрыть, кликнув на них. При раскрытии линии отображаются участки линии (сегменты), а внутри каждого сегмента находится папка с опорами, принадлежащими данному сегменту. Опоры, не привязанные к конкретному сегменту, отображаются в отдельной папке "Опоры" на уровне линии электропередач. Каждый элемент дерева показывает соответствующую иконку и дополнительную информацию: для линий отображается уровень напряжения в киловольтах, для сегментов - количество опор в сегменте.

*См. дерево объектов: `web-frontend/src/app/layout/sidebar/sidebar.component.html:1-87`, построение иерархии: `web-frontend/src/app/layout/sidebar/sidebar.component.ts:89-160`*

При клике левой кнопкой мыши на объект в дереве карта автоматически центрируется на соответствующем географическом объекте. Для опор применяется специальная логика зума: если текущий зум карты меньше 13, устанавливается зум 10; если зум равен 13, зум не изменяется; если зум больше или равен 14, карта возвращается к зуму 10. Это обеспечивает оптимальный масштаб для просмотра опор независимо от текущего состояния карты.

*См. логику центрирования: `web-frontend/src/app/layout/sidebar/sidebar.component.ts:219-267`*

## Создание объектов

Для создания нового объекта необходимо нажать кнопку с иконкой плюса в правом верхнем углу карты. Откроется диалоговое окно создания объекта, в котором сначала необходимо выбрать тип создаваемого объекта: ЛЭП, подстанция, опора или оборудование. После выбора типа объекта отображается соответствующая форма с полями для ввода данных. При создании опоры необходимо указать номер опоры, выбрать родительскую ЛЭП из списка, ввести координаты (широту и долготу), выбрать тип опоры и при необходимости заполнить дополнительные поля, такие как высота, материал, год установки и другие. Система автоматически генерирует уникальный идентификатор (UID) для нового объекта, но пользователь может указать свой UID в соответствующем поле.

*См. диалог создания: `web-frontend/src/app/features/map/create-object-dialog/create-object-dialog.component.html:1-261`, обработка создания: `web-frontend/src/app/features/map/create-object-dialog/create-object-dialog.component.ts:175-300`*

Форма создания объекта включает валидацию данных на стороне клиента: проверяется заполнение обязательных полей, корректность формата координат (широта должна быть от -90 до 90, долгота от -180 до 180), формат уникального идентификатора при его указании. При отправке данных на сервер также выполняется валидация на стороне сервера, и в случае ошибок пользователю отображаются понятные сообщения об ошибках на русском языке.

*См. валидацию: `web-frontend/src/app/features/map/create-object-dialog/create-object-dialog.component.ts:342-367` (валидаторы координат), `web-frontend/src/app/features/map/create-object-dialog/create-object-dialog.component.ts:557-601` (обработка ошибок)*

## Удаление объектов

Для удаления объекта необходимо кликнуть правой кнопкой мыши на соответствующем элементе в дереве объектов. Откроется диалоговое окно подтверждения удаления, в котором отображается тип объекта и его название. Пользователь должен подтвердить удаление, нажав кнопку "Удалить", или отменить операцию. После подтверждения система отправляет запрос на удаление объекта на сервер, и при успешном удалении данные на карте и в дереве объектов автоматически обновляются.

*См. удаление объектов: `web-frontend/src/app/layout/sidebar/sidebar.component.ts:274-320` (обработчик правой кнопки мыши), `web-frontend/src/app/features/map/delete-object-dialog/delete-object-dialog.component.html:1-17` (диалог подтверждения)*

## Обновление данных

Для обновления данных на карте и в дереве объектов необходимо нажать кнопку с иконкой обновления в правом верхнем углу карты. Система загрузит актуальные данные с сервера и обновит отображение всех объектов на карте и в дереве. Обновление данных также происходит автоматически после создания или удаления объектов.

*См. обновление данных: `web-frontend/src/app/features/map/map.component.ts:447-449`, `web-frontend/src/app/core/services/map.service.ts:30-33`*

## Управление масштабированием карты

Пользователь может управлять масштабом карты несколькими способами: используя колесо прокрутки мыши, используя кнопки увеличения и уменьшения зума в левом нижнем углу карты, или используя стандартные элементы управления картой Leaflet. Индикатор зума показывает текущий уровень масштабирования в инвертированном виде (где 1 соответствует минимальному зуму и большому масштабу, а 28 - максимальному зуму и маленькому масштабу) и примерное расстояние, видимое на карте в текущем масштабе. При изменении масштаба карты автоматически обновляется отображение подписей опор в зависимости от уровня зума.

*См. управление зумом: `web-frontend/src/app/features/map/map.component.ts:525-535`, расчет расстояния: `web-frontend/src/app/features/map/map.component.ts:45-76`*

## Работа с боковой панелью

Боковую панель с деревом объектов можно скрыть или показать, нажав на кнопку со стрелкой, расположенную слева от панели. Ширину панели можно изменить, перетаскивая правую границу панели мышью. При изменении ширины панели индикатор зума автоматически перемещается, чтобы не перекрываться с панелью. Это обеспечивает удобство работы с интерфейсом независимо от размера панели.

*См. управление панелью: `web-frontend/src/app/layout/main-layout/main-layout.component.ts:51-53`, `web-frontend/src/app/core/services/sidebar.service.ts:1-38`*

## Выход из системы

Для выхода из системы необходимо кликнуть на иконку профиля в правом верхнем углу экрана и выбрать пункт меню "Выйти". Система очистит данные аутентификации и перенаправит пользователя на экран входа.

*См. выход из системы: `web-frontend/src/app/layout/main-layout/main-layout.component.ts:60-63`, `web-frontend/src/app/core/services/auth.service.ts:79-84`*
