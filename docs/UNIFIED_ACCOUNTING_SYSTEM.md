# Концепция единой системы учета ЛЭП и Подстанций

## Общая идея системы учета

Создание единой ERP-подобной системы учета энергетической инфраструктуры, которая обеспечивает полный учет объектов от верхнего уровня (ЛЭП/Подстанции) до конкретных единиц оборудования, с единообразным интерфейсом и CIM-совместимой структурой данных.

## Архитектурная концепция

### Принцип единого интерфейса

Система должна предоставлять единый подход к учету всех объектов энергосистемы:

```
┌─────────────────────────────────────────────────────────────┐
│           ЕДИНАЯ СИСТЕМА УЧЕТА                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐              ┌──────────────┐          │
│  │   ЛЭП        │              │  Подстанции  │          │
│  │              │              │              │          │
│  │ ЛЭП → Сегм.  │              │ Подст. → Ур. │          │
│  │ → Опоры      │              │ напр. → Яч. │          │
│  │ → Оборуд.    │              │ → Оборуд.   │          │
│  └──────────────┘              └──────────────┘          │
│         │                            │                     │
│         └────────────┬───────────────┘                     │
│                      │                                     │
│              ┌───────▼────────┐                           │
│              │  Единый UI     │                           │
│              │  - Дерево      │                           │
│              │  - Таблицы     │                           │
│              │  - Карта       │                           │
│              └────────────────┘                           │
└─────────────────────────────────────────────────────────────┘
```

## Варианты реализации

### Вариант 1: Единый модуль "Учет объектов" (Рекомендуется)

Создать единый модуль `accounting` или `objects-management`, который объединяет учет ЛЭП и Подстанций.

**Структура:**

```
accounting/
├── accounting.module.ts
├── accounting-routing.module.ts
│
├── objects-list/                    # Единый список всех объектов
│   ├── objects-list.component.*
│   ├── object-card/                # Карточка объекта (ЛЭП или Подстанция)
│   └── filters/                    # Фильтры по типу, региону и т.д.
│
├── object-detail/                  # Детальный просмотр (универсальный)
│   ├── object-detail.component.*
│   ├── tabs/
│   │   ├── info-tab/               # Основная информация
│   │   ├── structure-tab/          # Иерархическая структура
│   │   ├── equipment-tab/          # Оборудование
│   │   └── connections-tab/       # Подключения
│   └── object-header/              # Заголовок с действиями
│
├── structure-tree/                 # Универсальное дерево структуры
│   ├── structure-tree.component.*
│   ├── tree-node/                  # Универсальный узел дерева
│   └── node-types/
│       ├── power-line-node/
│       ├── segment-node/
│       ├── pole-node/
│       ├── substation-node/
│       ├── voltage-level-node/
│       ├── bay-node/
│       └── equipment-node/
│
├── equipment-manager/              # Управление оборудованием
│   ├── equipment-manager.component.*
│   ├── equipment-list/             # Список оборудования
│   ├── equipment-form/             # Форма создания/редактирования
│   └── equipment-filters/          # Фильтры по типу, статусу
│
└── services/
    ├── accounting.service.ts       # Единый сервис учета
    ├── structure.service.ts        # Работа со структурами
    └── equipment.service.ts        # Работа с оборудованием
```

**Преимущества:**
- Единый интерфейс для всех объектов
- Переиспользование компонентов
- Проще поддерживать
- Единообразный UX

**Недостатки:**
- Более сложная логика в компонентах (нужно различать типы объектов)
- Больше кода в одном модуле

### Вариант 2: Раздельные модули с общей архитектурой

Создать отдельные модули `power-lines` и `substations`, но с единой архитектурой и общими компонентами.

**Структура:**

```
shared/
├── components/
│   ├── structure-tree/             # Общее дерево структуры
│   ├── equipment-manager/          # Общий менеджер оборудования
│   └── object-detail-tabs/         # Общие вкладки
│
power-lines/
├── power-lines-list/
├── power-line-detail/
└── services/
    └── power-line-structure.service.ts

substations/
├── substations-list/
├── substation-detail/
└── services/
    └── substation-structure.service.ts
```

**Преимущества:**
- Четкое разделение ответственности
- Проще навигация по коду
- Можно развивать независимо

**Недостатки:**
- Дублирование логики
- Сложнее поддерживать единообразие

### Вариант 3: Гибридный подход (Оптимальный)

Объединить оба подхода: общие компоненты в `shared`, специфичные - в отдельных модулях.

**Структура:**

```
shared/
├── components/
│   ├── structure-tree/             # Универсальное дерево
│   ├── equipment-manager/          # Универсальный менеджер оборудования
│   ├── object-detail-layout/        # Общий layout детального просмотра
│   └── filters-panel/              # Общие фильтры
│
power-lines/
├── power-lines-list/
├── power-line-detail/
│   ├── power-line-info-tab/        # Специфичная вкладка для ЛЭП
│   └── power-line-structure-tab/   # Специфичная структура ЛЭП
│
substations/
├── substations-list/
├── substation-detail/
│   ├── substation-info-tab/        # Специфичная вкладка для Подстанций
│   └── substation-structure-tab/   # Специфичная структура Подстанций
```

**Преимущества:**
- Переиспользование общих компонентов
- Специфичная логика в отдельных модулях
- Гибкость и масштабируемость

## UI/UX концепция

### Главный экран учета

```
┌─────────────────────────────────────────────────────────────┐
│  Учет объектов                          [+ Создать объект] │
├─────────────────────────────────────────────────────────────┤
│  [Все объекты ▼] [ЛЭП] [Подстанции] [Регион: Все ▼] [🔍]    │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 📍 ЛЭП-001 "Центральная"                  [⋮]       │  │
│  │ 10 кВ | 15 км | Опоры: 45 | Оборудование: 120 ед.  │  │
│  │ Статус: Активна | Регион: Минск                     │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 🏭 ТП-123 "Центральная"                   [⋮]       │  │
│  │ 10 кВ | РУ: 2 | Ячейки: 15 | Оборудование: 45 ед.   │  │
│  │ Статус: Активна | Регион: Минск                     │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### Детальный просмотр (универсальный)

```
┌─────────────────────────────────────────────────────────────┐
│  ← Назад    ЛЭП-001 "Центральная"            [✏️] [🗑️] [📤]│
├─────────────────────────────────────────────────────────────┤
│  [Информация] [Структура] [Оборудование] [Подключения]      │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Основная информация                                  │  │
│  │ Тип: ЛЭП | Код: ЛЭП-001 | Напряжение: 10 кВ       │  │
│  │ Длина: 15 км | Опоры: 45 | Сегменты: 12            │  │
│  │ Регион: Минск | Статус: Активна                      │  │
│  │ Координаты: [📍 Показать на карте]                   │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### Вкладка "Структура" (универсальное дерево)

```
┌─────────────────────────────────────────────────────────────┐
│  Структура объекта                          [+ Добавить]   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Для ЛЭП:                                                   │
│  📍 ЛЭП-001 "Центральная"                      [✏️] [🗑️]   │
│    ├─ 📏 Сегмент 1                              [✏️] [🗑️] │
│    │   ├─ 🗼 Опора 1                             [✏️] [🗑️] │
│    │   │   ├─ ⚡ Изолятор ПС-70                 [✏️] [🗑️] │
│    │   │   └─ 🔌 Разрядник РВО-10               [✏️] [🗑️] │
│    │   └─ 🗼 Опора 2                             [✏️] [🗑️] │
│    └─ 📏 Сегмент 2                              [✏️] [🗑️] │
│                                                              │
│  Для Подстанции:                                             │
│  🏭 ТП-123 "Центральная"                      [✏️] [🗑️]   │
│    ├─ ⚡ Уровень 10 кВ                         [✏️] [🗑️]   │
│    │   ├─ 📦 Ячейка 1                           [✏️] [🗑️]   │
│    │   │   ├─ ⚡ Выключатель ВМГ-10            [✏️] [🗑️]   │
│    │   │   └─ 🔌 Разъединитель РЛНД-10         [✏️] [🗑️]   │
│    │   └─ 📦 Ячейка 2                           [✏️] [🗑️]   │
│    └─ ⚡ Уровень 0.4 кВ                         [✏️] [🗑️]   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### Вкладка "Оборудование" (универсальная таблица)

```
┌─────────────────────────────────────────────────────────────┐
│  Оборудование (165 ед.)                    [+ Добавить]     │
├─────────────────────────────────────────────────────────────┤
│  [Все типы ▼] [Статус: Все ▼] [Поиск...] [Экспорт]        │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ЛЭП-001 / Сегмент 1 / Опора 1                            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ⚡ Изолятор ПС-70                            [✏️]   │  │
│  │ Производитель: Энергомаш | Модель: ПС-70             │  │
│  │ Серийный номер: SN-12345                               │  │
│  │ Статус: Активен | Установлен: 01.01.2020              │  │
│  │ Следующее ТО: 01.07.2024                              │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ТП-123 / Уровень 10 кВ / Ячейка 1                         │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ⚡ Выключатель ВМГ-10                        [✏️]   │  │
│  │ ABB | ВМГ-10 | SN-67890                                │  │
│  │ Статус: Активен | Установлен: 01.01.2020              │  │
│  │ Следующее ТО: 01.07.2024                              │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## Навигация и доступ

### Варианты доступа к учету

**Вариант A: Кнопка в верхней панели (Рекомендуется)**

```
┌─────────────────────────────────────────────────────────────┐
│  [Карта] [Учет объектов] [Отчеты] [Настройки] [Выход]      │
└─────────────────────────────────────────────────────────────┘
```

- Кнопка "Учет объектов" открывает единый список всех объектов
- Фильтры позволяют показывать только ЛЭП или только Подстанции
- Двойной клик на объекте на карте также открывает детальный просмотр

**Вариант B: Вкладки в главном меню**

```
┌─────────────────────────────────────────────────────────────┐
│  [Карта] [ЛЭП] [Подстанции] [Отчеты] [Настройки] [Выход]   │
└─────────────────────────────────────────────────────────────┘
```

- Отдельные вкладки для ЛЭП и Подстанций
- Каждая вкладка открывает соответствующий список

**Вариант C: Боковая панель с переключателем**

```
┌──────────┬─────────────────────────────────────────────────┐
│ [ЛЭП]    │                                                 │
│ [Подст.] │         Основной контент                        │
│ [Все]    │                                                 │
└──────────┴─────────────────────────────────────────────────┘
```

## Ключевые функции системы учета

### 1. Единый список объектов

- Отображение всех ЛЭП и Подстанций в одном списке
- Фильтрация по типу, региону, статусу, напряжению
- Поиск по названию, коду, mRID
- Сортировка по различным параметрам
- Экспорт данных (Excel, CSV, CIM)

### 2. Детальный просмотр

- Универсальный компонент для всех типов объектов
- Вкладки: Информация, Структура, Оборудование, Подключения
- Действия: Редактировать, Удалить, Экспорт в CIM, Показать на карте
- История изменений (опционально)

### 3. Иерархическое дерево структуры

- Универсальный компонент дерева для ЛЭП и Подстанций
- Раскрытие/сворачивание узлов
- Контекстное меню для каждого узла (Правый клик)
- Drag & Drop для изменения структуры (опционально)
- Визуальное различие типов узлов (иконки, цвета)

### 4. Управление оборудованием

- Единая таблица всего оборудования объекта
- Группировка по уровням иерархии
- Фильтрация по типу, статусу, дате обслуживания
- Массовые операции (изменение статуса, экспорт)
- Планирование обслуживания (календарь ТО)

### 5. Интеграция с картой

- Синхронизация: изменения в учете отражаются на карте
- Навигация: из карты в учет, из учета на карту
- Визуализация: отображение статусов на карте
- Геопривязка: создание объектов с привязкой к координатам

## Техническая реализация

### Backend структура

```
backend/app/
├── api/v1/
│   ├── accounting/                 # Единые endpoints для учета
│   │   ├── objects.py             # Список всех объектов
│   │   ├── structure.py            # Работа со структурами
│   │   └── equipment.py            # Работа с оборудованием
│   ├── power_lines/                # Специфичные для ЛЭП
│   └── substations/                # Специфичные для Подстанций
│
├── models/
│   ├── power_line.py               # Модели ЛЭП
│   ├── substation.py               # Модели Подстанций
│   └── equipment.py                # Общие модели оборудования
│
└── schemas/
    ├── accounting.py               # Общие схемы для учета
    ├── power_line.py
    └── substation.py
```

### Frontend структура (Гибридный подход)

```
web-frontend/src/app/
├── shared/
│   ├── components/
│   │   ├── structure-tree/
│   │   ├── equipment-manager/
│   │   └── object-detail-layout/
│   └── services/
│       └── accounting.service.ts
│
├── features/
│   ├── accounting/                 # Единый модуль учета
│   │   ├── objects-list/
│   │   ├── object-detail/
│   │   └── services/
│   │
│   ├── power-lines/                # Специфичные для ЛЭП
│   │   └── power-line-detail/
│   │
│   └── substations/                # Специфичные для Подстанций
│       └── substation-detail/
│
└── layout/
    └── main-layout/
        └── main-layout.component.*  # Добавить кнопку "Учет"
```

## Рекомендации по реализации

### Этап 1: Backend - Единые API

1. Создать `/api/v1/accounting/objects` - список всех объектов
2. Создать `/api/v1/accounting/structure/{object_type}/{id}` - структура объекта
3. Создать `/api/v1/accounting/equipment/{object_type}/{id}` - оборудование объекта
4. Реализовать CIM экспорт для всех объектов

### Этап 2: Frontend - Общие компоненты

1. Создать `shared/components/structure-tree` - универсальное дерево
2. Создать `shared/components/equipment-manager` - менеджер оборудования
3. Создать `shared/services/accounting.service` - единый сервис

### Этап 3: Frontend - Модуль учета

1. Создать `features/accounting/objects-list` - единый список
2. Создать `features/accounting/object-detail` - детальный просмотр
3. Интегрировать с картой (двойной клик, навигация)

### Этап 4: Интеграция и тестирование

1. Протестировать создание/редактирование объектов
2. Проверить синхронизацию с картой
3. Протестировать CIM экспорт/импорт
4. Оптимизировать производительность

## Дополнительные возможности

### 1. Отчеты и аналитика

- Статистика по объектам (количество, длина, оборудование)
- Отчеты по обслуживанию оборудования
- Планирование ТО и ремонтов
- Экспорт отчетов в различные форматы

### 2. История изменений

- Аудит всех изменений объектов
- Версионирование структуры
- Откат изменений (опционально)

### 3. Массовые операции

- Массовое изменение статусов
- Массовое добавление оборудования
- Массовый экспорт данных

### 4. Интеграция с внешними системами

- Импорт из CIM файлов
- Экспорт в CIM для других систем
- API для интеграции с ERP системами

## Итоговая рекомендация

**Рекомендую Гибридный подход:**

1. **Общие компоненты** в `shared/` для переиспользования
2. **Единый модуль учета** `accounting/` для списка и общего функционала
3. **Специфичные модули** `power-lines/` и `substations/` для деталей
4. **Единый сервис** `accounting.service.ts` для работы с API
5. **Кнопка в панели** "Учет объектов" для доступа

Это обеспечит:
- ✅ Единообразный интерфейс
- ✅ Переиспользование кода
- ✅ Гибкость и масштабируемость
- ✅ Простоту поддержки
- ✅ CIM совместимость
