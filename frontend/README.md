# ЛЭП Management System - Frontend

Flutter мобильное приложение для системы управления линиями электропередач.

## Технологии

- **Flutter 3.0+**
- **Dart 3.0+**
- **Riverpod** - управление состоянием
- **Go Router** - навигация
- **Drift** - локальная база данных (SQLite)
- **Dio** - HTTP клиент
- **Flutter Map** - карты
- **Geolocator** - GPS

## Установка

### 1. Установка Flutter

Следуйте официальной документации: https://flutter.dev/docs/get-started/install

### 2. Установка зависимостей

```bash
flutter pub get
```

### 3. Генерация кода

```bash
flutter packages pub run build_runner build
```

### 4. Запуск приложения

```bash
# Debug режим
flutter run

# Release режим
flutter run --release
```

## Структура проекта

```
frontend/
├── lib/
│   ├── core/
│   │   ├── config/         # Конфигурация приложения
│   │   ├── database/       # Локальная база данных
│   │   ├── models/         # Модели данных
│   │   ├── router/         # Навигация
│   │   ├── services/       # Сервисы (API, Auth, Sync)
│   │   └── theme/          # Темы оформления
│   ├── features/
│   │   ├── auth/           # Авторизация
│   │   ├── home/           # Главная страница
│   │   ├── map/            # Карта
│   │   ├── power_lines/    # ЛЭП
│   │   ├── profile/        # Профиль
│   │   └── towers/         # Опоры
│   └── main.dart           # Точка входа
├── assets/                 # Ресурсы (изображения, иконки)
└── pubspec.yaml           # Зависимости
```

## Основные функции

### Авторизация
- Вход в систему
- Регистрация новых пользователей
- Сохранение токена в secure storage
- Автоматическое обновление токена

### ЛЭП
- Создание новых линий электропередач
- Просмотр списка ЛЭП
- Детальная информация о ЛЭП
- Добавление опор к ЛЭП

### Опоры
- Фиксация опор с GPS координатами
- Добавление информации об оборудовании
- Фотофиксация (планируется)
- Состояние опоры

### Карта
- Отображение всех ЛЭП и опор
- GPS навигация
- Интерактивные маркеры
- Легенда карты

### Синхронизация
- Автоматическая синхронизация
- Работа в офлайн режиме
- Конфликт-резолюшн
- Локальная база данных

## Локальная база данных

Приложение использует Drift (обертка над SQLite) для локального хранения данных:

### Таблицы
- **PowerLines** - ЛЭП
- **Towers** - Опоры  
- **Equipment** - Оборудование
- **SyncRecords** - Записи синхронизации

### Особенности
- Автоматическая генерация кода
- Типобезопасные запросы
- Миграции схемы
- Офлайн поддержка

## API Integration

### HTTP Client
- Dio для HTTP запросов
- Retrofit для генерации API клиента
- Автоматическое добавление токенов
- Обработка ошибок

### Модели данных
- JSON сериализация/десериализация
- Валидация данных
- Типобезопасность

## Навигация

### Go Router
- Декларативная навигация
- Защищенные маршруты
- Глубокие ссылки
- Состояние навигации

### Маршруты
- `/login` - Авторизация
- `/register` - Регистрация
- `/home` - Главная страница
- `/power-lines` - Список ЛЭП
- `/towers` - Список опор
- `/map` - Карта
- `/profile` - Профиль

## Управление состоянием

### Riverpod
- Provider для сервисов
- StateNotifier для состояния
- ConsumerWidget для UI
- Автоматическое обновление UI

### Основные провайдеры
- `authServiceProvider` - Сервис авторизации
- `apiServiceProvider` - API клиент
- `syncServiceProvider` - Синхронизация
- `databaseProvider` - Локальная БД

## Карты

### Flutter Map
- OpenStreetMap тайлы
- Интерактивные маркеры
- Полилинии для ЛЭП
- Кастомные иконки

### GPS
- Текущее местоположение
- Разрешения
- Точность позиционирования

## Синхронизация

### Офлайн поддержка
- Локальное сохранение данных
- Отложенная синхронизация
- Конфликт-резолюшн
- Индикаторы состояния

### Алгоритм
1. Сохранение данных локально
2. Помечание для синхронизации
3. Автоматическая отправка при наличии сети
4. Получение изменений с сервера
5. Применение изменений локально

## Сборка

### Debug
```bash
flutter run --debug
```

### Release
```bash
flutter build apk --release
flutter build ios --release
```

### Тестирование
```bash
flutter test
flutter integration_test
```

## Конфигурация

### App Config
- URL сервера
- Настройки карты
- Параметры синхронизации
- UI константы

### Environment
- Debug/Release настройки
- Различные серверы
- Логирование

## Разработка

### Добавление новых экранов

1. Создайте страницу в `features/`
2. Добавьте маршрут в `router/app_router.dart`
3. Создайте провайдеры если нужно
4. Добавьте навигацию

### Добавление API endpoints

1. Обновите модели в `core/models/`
2. Добавьте методы в `core/services/api_service.dart`
3. Запустите генерацию кода
4. Используйте в UI

### Работа с базой данных

1. Обновите таблицы в `core/database/database.dart`
2. Запустите генерацию кода
3. Создайте методы доступа
4. Обновите миграции

## Отладка

### Логи
```bash
flutter logs
```

### Инспектор
```bash
flutter inspector
```

### Performance
```bash
flutter run --profile
```

## Поддержка

